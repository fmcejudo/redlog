common_query: '{stream_filter="ALERTHUB", level="ERROR", environment="pro", slot="engine"}'

queries:
  - id: Response with 4.x.x code
    description: Response with 4.x.x code
    type: SERVICE
    query: |
      sum by (short_message)(count_over_time(
        <common_query>
        |~ `422 Unprocessable Entity` | json | line_format `- {{.level}} - {{.short_message}}`[1m]
      ))
  - id: Gateway timeout
    description: Gateway timeout
    type: SERVICE
    query: |
      sum by(platform,short_message) (count_over_time(
          <common_query>
          |~ `504 Gateway Timeout from POST`
          | json | line_format `- {{.level}} - {{.short_message}}`[24h]
      ))
  - id: Redis not connected
    description: Redis not connected
    type: SERVICE
    query: |
      sum by(platform) (count_over_time(
          <common_query>
          |~ `RedisException: Currently not connected`
          | json | line_format `- {{.level}} - {{.short_message}}`[1m]
      ))
  - id: Number Format Exception
    description: Number Format Exception
    type: COUNT
    query: |
      sum by(alert) (count_over_time(
          <common_query>
          |~ `check queries java.lang.NumberFormatException: For input string:`
          | json | line_format "- {{.level}} - {{.short_message}}" [24h]
      ))
  - id: Network issues
    description: Network issues
    type: SERVICE
    query: |
      sum by(timestamp) (count_over_time(
          <common_query>
          |~ `SslHandshakeTimeoutException: handshake timed out after 10000ms|Connection reset by peer|Connection reset by peer`
          | json | line_format "- {{.level}} - {{.short_message}}" [1m]
      ))
  - id: Alert Definitions in Quarantine
    description: Alert Definitions in Quarantine
    type: COUNT
    query: |
      sum by(alert,short_message) (count_over_time(
          <common_query>
           |~ `Task is quarantined and it will be skipped`
           | json | line_format "- {{.level}} - {{.short_message}}" [24h]
      ))
  - id: tags-matching
    description: tags matching queries
    type: COUNT
    query: |
      sum by(alert,short_message)(
         count_over_time(
             <common_query>
             |~ `TimeSeries Database did not return the same matching tags`
             | json | line_format "- {{.level}} - {{.short_message}}" [24h]
          )
      )